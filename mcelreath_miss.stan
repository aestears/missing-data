
 

/*----------------------- Functions --------------------------*/  
  functions{
    vector merge_missing( int[] y_index_mis, vector y_miss, vector y_imp) {
    int N = dims(y_miss)[1];
    int N_miss = dims(y_imp)[1];
    vector[N] merged;
    merged = y_miss;
    for (i in 1:N_miss)
        merged[y_index_mis[i] ] =y_imp[i];
    return merged;    
    }
  }
  
/*----------------------- Data --------------------------*/
  /* Data block: defines the objects that will be inputted as data */
  data {
    int N; // Length of state and observation time series
    vector[N] y_miss; // Observations
    real z0; // Initial state value
    vector[N] light;
    int y_nMiss; // number of missing values
    int y_index_mis[y_nMiss]; // index or location of missing values within the dataset
  }
  
/*----------------------- Parameters --------------------------*/
  /* Parameter block: defines the variables that will be sampled */
  parameters {
    vector<lower = 0>[y_nMiss] y_imp;// Missing data
    real<lower=0> sdp; // Standard deviation of the process equation
    //real<lower=0> sdo; // Standard deviation of the observation equation
    real b0;
    real b1;
    real<lower = 0, upper=1 > phi; // Auto-regressive parameter
    //vector[N] z; // State time series
  }
  

  /*----------------------- Model --------------------------*/
  /* Model block: defines the model */
  model {
    //merge imputed and observed data
    vector[N] B_merge;
    B_merge= merge_missing(y_index_mis, to_vector(y_miss), y_imp);
   
    // Prior distributions
    //sdo ~ normal(0, 1);
    sdp ~ normal(0, 1);
    phi ~ beta(1,1);
    b0 ~ normal(0,5);
    b1 ~ normal(0,5);
    
    // Distribution for the first state
   B_merge[1] ~ normal(z0, sdp);
    
    // Distributions for all other states
    for(t in 2:N){
       B_merge[t] ~ normal(b0+ B_merge [t-1]*phi+light[t]*b1, sdp);
    }
   
  }
  
  
    
  [1] 6.136688 6.146110 6.155921 6.166104 6.176643 6.187519 6.198716 6.210217 6.222004 6.234060 6.246369 6.258914 6.271680 6.284649 6.297807
 [16] 6.311137 6.324626 6.338259 6.352022 6.365900 6.379881 6.393952 6.408100 6.422314 6.436581 6.450891 6.465234 6.479598 6.493974 6.508352
 [31] 6.522724 6.537081 6.551415 6.565718 6.579982 6.594200 6.608366 6.622473 6.636515 6.650486 6.664381 6.678195 6.691923 6.705559 6.719101
 [46] 6.732544 6.745884 6.759118 6.772242 6.785253 6.798148 6.810925 6.823581 6.836115 6.848523 6.860804 6.872956 6.884978 6.896868 6.908625
 [61] 6.920248 6.931736 6.943088 6.954303 6.965380 6.976320 6.987121 6.997784 7.008309 7.018694 7.028941 7.039049 7.049019 7.058851 7.068545
 [76] 7.078101 7.087521 7.096804 7.105951 7.114963 7.123841 7.132586 7.141197 7.149677 7.158026 7.166245 7.174334 7.182296 7.190131 7.197840
 [91] 7.205424 7.212885 7.220223 7.227440 7.234537 7.241515 7.248375 7.255119 7.261748 7.268263 7.274665 7.280955 7.287136 7.293207 7.299171
[106] 7.305028 7.310781 7.316429 7.321974 7.327418 7.332761 7.338006 7.343152 7.348201 7.353155 7.358014 7.362780 7.367453 7.372035 7.376527
[121] 7.380929 7.385243 7.389470 7.393611 7.397666 7.401637 7.405524 7.409328 7.413051 7.416692 7.420254 7.423735 7.427138 7.430462 7.433709
[136] 7.436880 7.439974 7.442992 7.445935 7.448804 7.451599 7.454320 7.456968 7.459543 7.462046 7.464477 7.466836 7.469123 7.471340 7.473485
[151] 7.475560 7.477564 7.479497 7.481361 7.483154 7.484876 7.486528 7.488110 7.489622 7.491063 7.492433 7.493733 7.494962 7.496119 7.497205
[166] 7.498219 7.499161 7.500031 7.500828 7.501551 7.502201 7.502776 7.503277 7.503702 7.504052 7.504324 7.504520 7.504637 7.504676 7.504635
[181] 7.504513 7.504311 7.504027 7.503659 7.503208 7.502672 7.502050 7.501341 7.500544 7.499658 7.498682 7.497615 7.496455 7.495201 7.493852
[196] 7.492407 7.490864 7.489222 7.487480 7.485636 7.483689 7.481637 7.479479 7.477214 7.474840 7.472356 7.469759 7.467049 7.464223 7.461281
[211] 7.458220 7.455039 7.451737 7.448311 7.444761 7.441084 7.437278 7.433343 7.429276 7.425076 7.420741 7.416270 7.411660 7.406910 7.402018
[226] 7.396984 7.391804 7.386478 7.381004 7.375380 7.369604 7.363676 7.357593 7.351355 7.344959 7.338404 7.331689 7.324812 7.317772 7.310568
[241] 7.303198 7.295662 7.287957 7.280083 7.272038 7.263823 7.255434 7.246873 7.238138 7.229227 7.220141 7.210879 7.201440 7.191823 7.182029
[256] 7.172056 7.161905 7.151576 7.141068 7.130382 7.119517 7.108474 7.097253 7.085855 7.074281 7.062530 7.050605 7.038506 7.026234 7.013790
[271] 7.001176 6.988394 6.975446 6.962333 6.949057 6.935621 6.922028 6.908280 6.894379 6.880331 6.866136 6.851800 6.837327 6.822719 6.807982
[286] 6.793121 6.778139 6.763043 6.747838 6.732530 6.717125 6.701629 6.686049 6.670393 6.654667 6.638880 6.623041 6.607156 6.591237 6.575292
[301] 6.559330 6.543363 6.527401 6.511455 6.495536 6.479657 6.463830 6.448068 6.432385 6.416793 6.401307 6.385942 6.370713 6.355635 6.340723
[316] 6.325995 6.311466 6.297152 6.283072 6.269243 6.255681 6.242404 6.229430 6.216778 6.204464 6.192507 6.180923 6.169732 6.158949 6.148592
[331] 6.138677 6.129221 6.120239 6.111746 6.103757 6.096285 6.089343 6.082943 6.077095 6.071810 6.067098 6.062964 6.059417 6.056462 6.054102
[346] 6.052342 6.051182 6.050623 6.050664 6.051303 6.052537 6.054361 6.056769 6.059754 6.063308 6.067422 6.072086 6.077288 6.083017 6.089259
[361] 6.096001 6.103228 6.110927 6.119080 6.127672
  [1] 6.136688 6.146110 6.155921 6.166104 6.176643 6.187519 6.198716 6.210217 6.222004 6.234060 6.246369 6.258914 6.271680 6.284649 6.297807
 [16] 6.311137 6.324626 6.338259 6.352022 6.365900 6.379881 6.393952 6.408100 6.422314 6.436581 6.450891 6.465234 6.479598 6.493974 6.508352
 [31] 6.522724 6.537081 6.551415 6.565718 6.579982 6.594200 6.608366 6.622473 6.636515 6.650486 6.664381 6.678195 6.691923 6.705559 6.719101
 [46] 6.732544 6.745884 6.759118 6.772242 6.785253 6.798148 6.810925 6.823581 6.836115 6.848523 6.860804 6.872956 6.884978 6.896868 6.908625
 [61] 6.920248 6.931736 6.943088 6.954303 6.965380 6.976320 6.987121 6.997784 7.008309 7.018694 7.028941 7.039049 7.049019 7.058851 7.068545
 [76] 7.078101 7.087521 7.096804 7.105951 7.114963 7.123841 7.132586 7.141197 7.149677 7.158026 7.166245 7.174334 7.182296 7.190131 7.197840
 [91] 7.205424 7.212885 7.220223 7.227440 7.234537 7.241515 7.248375 7.255119 7.261748 7.268263 7.274665 7.280955 7.287136 7.293207 7.299171
[106] 7.305028 7.310781 7.316429 7.321974 7.327418 7.332761 7.338006 7.343152 7.348201 7.353155 7.358014 7.362780 7.367453 7.372035 7.376527
[121] 7.380929 7.385243 7.389470 7.393611 7.397666 7.401637 7.405524 7.409328 7.413051 7.416692 7.420254 7.423735 7.427138 7.430462 7.433709
[136] 7.436880 7.439974 7.442992 7.445935 7.448804 7.451599 7.454320 7.456968 7.459543 7.462046 7.464477 7.466836 7.469123 7.471340 7.473485
[151] 7.475560 7.477564 7.479497 7.481361 7.483154 7.484876 7.486528 7.488110 7.489622 7.491063 7.492433 7.493733 7.494962 7.496119 7.497205
[166] 7.498219 7.499161 7.500031 7.500828 7.501551 7.502201 7.502776 7.503277 7.503702 7.504052 7.504324 7.504520 7.504637 7.504676 7.504635
[181] 7.504513 7.504311 7.504027 7.503659 7.503208 7.502672 7.502050 7.501341 7.500544 7.499658 7.498682 7.497615 7.496455 7.495201 7.493852
[196] 7.492407 7.490864 7.489222 7.487480 7.485636 7.483689 7.481637 7.479479 7.477214 7.474840 7.472356 7.469759 7.467049 7.464223 7.461281
[211] 7.458220 7.455039 7.451737 7.448311 7.444761 7.441084 7.437278 7.433343 7.429276 7.425076 7.420741 7.416270 7.411660 7.406910 7.402018
[226] 7.396984 7.391804 7.386478 7.381004 7.375380 7.369604 7.363676 7.357593 7.351355 7.344959 7.338404 7.331689 7.324812 7.317772 7.310568
[241] 7.303198 7.295662 7.287957 7.280083 7.272038 7.263823 7.255434 7.246873 7.238138 7.229227 7.220141 7.210879 7.201440 7.191823 7.182029
[256] 7.172056 7.161905 7.151576 7.141068 7.130382 7.119517 7.108474 7.097253 7.085855 7.074281 7.062530 7.050605 7.038506 7.026234 7.013790
[271] 7.001176 6.988394 6.975446 6.962333 6.949057 6.935621 6.922028 6.908280 6.894379 6.880331 6.866136 6.851800 6.837327 6.822719 6.807982
[286] 6.793121 6.778139 6.763043 6.747838 6.732530 6.717125 6.701629 6.686049 6.670393 6.654667 6.638880 6.623041 6.607156 6.591237 6.575292
[301] 6.559330 6.543363 6.527401 6.511455 6.495536 6.479657 6.463830 6.448068 6.432385 6.416793 6.401307 6.385942 6.370713 6.355635 6.340723
[316] 6.325995 6.311466 6.297152 6.283072 6.269243 6.255681 6.242404 6.229430 6.216778 6.204464 6.192507 6.180923 6.169732 6.158949 6.148592
[331] 6.138677 6.129221 6.120239 6.111746 6.103757 6.096285 6.089343 6.082943 6.077095 6.071810 6.067098 6.062964 6.059417 6.056462 6.054102
[346] 6.052342 6.051182 6.050623 6.050664 6.051303 6.052537 6.054361 6.056769 6.059754 6.063308 6.067422 6.072086 6.077288 6.083017 6.089259
[361] 6.096001 6.103228 6.110927 6.119080 6.127672
